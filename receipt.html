<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Receipt - Simpor Investment</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Import script font for signature */
        @import url('https://fonts.googleapis.com/css2?family=Homemade+Apple&display=swap');
        
        :root {
            --primary-color: #1F2937;
            --success-color: #059669;
            --background-color: #F9FAFB;
            --card-bg: #FFFFFF;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.05);
            --border-radius: 12px;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 20px;
            background-color: var(--background-color); 
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        
        .container { 
            width: 100%;
            max-width: 550px; 
            background-color: var(--card-bg); 
            padding: 40px; 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow); 
            border: 1px solid #E5E7EB;
        }

        .logo-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .logo-header img {
            max-width: 180px;
            height: auto;
            border-bottom: 2px solid #E5E7EB;
            padding-bottom: 15px;
            display: block;
            margin: 0 auto;
        }

        .status-header {
            text-align: center;
            padding-bottom: 25px;
            border-bottom: 1px solid #E5E7EB;
            margin-bottom: 30px;
        }

        .status-header .icon {
            color: var(--success-color);
            font-size: 3em;
            font-weight: 800;
            line-height: 1;
        }

        .status-header h1 {
            font-size: 2em;
            color: var(--primary-color);
            margin: 10px 0 5px 0;
            font-weight: 700;
        }

        .status-header p {
            color: #6B7280;
            font-size: 0.95em;
            margin: 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }

        .detail-row span:first-child {
            color: #6B7280;
            font-weight: 400;
        }

        .detail-row span:last-child {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        h3 {
            font-size: 1.1em;
            color: var(--primary-color);
            font-weight: 700;
            margin-top: 35px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E5E7EB;
        }

        .item-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .item-list li {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 0.95em;
            border-bottom: 1px solid #F3F4F6;
        }
        
        .item-list li span:first-child {
            color: var(--primary-color);
        }
        
        .item-list li span:last-child {
            color: var(--primary-color);
            font-weight: 600;
        }

        .totals {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #E5E7EB;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .grand-total {
            font-size: 1.8em;
            font-weight: 800;
        }

        .grand-total span:first-child {
            color: var(--primary-color);
        }

        .grand-total span:last-child {
            color: var(--success-color);
        }
        
        .receipt-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px dashed #D1D5DB;
            font-size: 0.85em;
            color: #9CA3AF;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .print-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
            text-decoration: none;
        }
        .print-btn:hover {
            background-color: #4B5563;
        }

        .shop-btn {
            background-color: #E5E7EB;
            color: var(--primary-color);
            border: 1px solid #D1D5DB;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
            text-decoration: none;
        }
        .shop-btn:hover {
            background-color: #D1D5DB;
        }

        .signature-area {
            margin-top: 40px;
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid #E5E7EB;
        }

        .signature-area p {
            font-style: italic;
            color: #6B7280;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .signature {
            /* Updated font for script/handwritten feel */
            font-family: 'Homemade Apple', cursive; 
            font-size: 2.5em; 
            line-height: 1;
            color: var(--primary-color);
            border-bottom: 2px dashed #D1D5DB;
            display: inline-block;
            padding: 0 10px 5px 10px;
            margin-bottom: 5px;
            font-weight: 400; /* Script fonts usually look better with normal weight */
        }

        @media print {
            .container {
                box-shadow: none !important;
                border: none !important;
                max-width: 100%;
                padding: 0; 
                margin: 0;
            }
            body { 
                background-color: white !important; 
                padding: 0; 
                display: block; 
            }
            .button-group, .receipt-footer p:last-child {
                display: none !important; 
            }
            h1, h3, .detail-row span:last-child, .grand-total span:first-child {
                color: #000 !important; 
            }
            .grand-total span:last-child {
                color: #000 !important; 
            }
            .status-header, .totals {
                border-color: #D1D5DB !important;
            }
            .transaction-details, .item-list, .totals {
                page-break-inside: avoid;
            }
            .signature {
                color: #000 !important;
                border-bottom: 2px dashed #000 !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="logo-header">
            <img src="simpor log.png" alt="Simpor Investment Logo">
        </div>

        <div class="status-header">
            <span class="icon">‚úì</span>
            <h1>Payment Confirmed</h1>
            <p>Your Simpor Investment payment was successful.</p>
        </div>

        <div class="transaction-details">
            <div class="detail-row">
                <span>Transaction ID:</span>
                <span id="receipt-transaction-id">MP20251105-55432</span>
            </div>
            <div class="detail-row">
                <span>Payment Method:</span>
                <span style="display: flex; align-items: center;"><img src="mpesa.png" alt="M-Pesa Logo" style="width: 40px; margin-right: 8px;"> M-Pesa</span>
            </div>
            <div class="detail-row">
                <span>Payer Phone:</span>
                <span id="receipt-phone">Loading...</span> 
            </div>
            <div class="detail-row">
                <span>Date Paid:</span>
                <span id="receipt-date">Loading...</span> 
            </div>
        </div>

        <h3>Order Items</h3>
        
        <ul class="item-list" id="order-items-list">
             <li id="loading-message"><span>Loading order details...</span><span></span></li>
        </ul>
        <div class="totals">
            
            <div class="total-row grand-total">
                <span>Amount Paid:</span>
                <span id="receipt-total-amount">Ksh 0</span> 
            </div>
        </div>
        
        <div class="signature-area">
            <div class="signature">
                Simpor Mgmt
            </div>
            <p>Authorized by Owner/Management</p>
        </div>

        <div class="receipt-footer">
            
            <div class="button-group">
                <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Receipt</button>
                
                <a href="index.html" class="shop-btn">üõçÔ∏è Continue Shopping</a>
            </div>

            <p style="margin-top: 15px;">This is your official payment receipt. For support, please contact us.</p>
            <p>‚Äî Simpor Investment ‚Äî</p>
        </div>
        
    </div>

    <script>
        function loadReceiptDetails() {
            const paidAmount = sessionStorage.getItem('lastPaymentAmount');
            const paidPhone = sessionStorage.getItem('lastPaymentPhone');
            const paidItemsString = sessionStorage.getItem('lastPaymentItems'); 
            
            const transactionId = 'MP' + Math.floor(Math.random() * 90000000 + 10000000);

            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZoneName: 'short' };
            const formattedDate = now.toLocaleDateString('en-US', options).replace(',', '');

            const itemListElement = document.getElementById('order-items-list');
            
            if (paidAmount && paidPhone && paidItemsString) {
                document.getElementById('receipt-total-amount').textContent = `Ksh ${paidAmount}`;
                document.getElementById('receipt-phone').textContent = paidPhone;
                document.getElementById('receipt-date').textContent = formattedDate;
                document.getElementById('receipt-transaction-id').textContent = transactionId;
                
                try {
                    const items = JSON.parse(paidItemsString) || [];
                    itemListElement.innerHTML = ''; 

                    if (items.length > 0) {
                        items.forEach(item => {
                            const li = document.createElement('li');
                            const itemName = item.name || 'Unknown Product'; 
                            const itemQuantity = item.quantity || 1;
                            const itemSubtotal = item.itemSubtotal || (item.price * itemQuantity) || 0;
                            const formattedPrice = itemSubtotal.toLocaleString(); 
                            
                            li.innerHTML = `<span>${itemName} x ${itemQuantity}</span><span>Ksh ${formattedPrice}</span>`;
                            itemListElement.appendChild(li);
                        });
                        
                        if (itemListElement.lastElementChild) {
                            itemListElement.lastElementChild.style.borderBottom = 'none';
                        }
                    } else {
                        itemListElement.innerHTML = '<li><span>No specific items listed.</span><span></span></li>';
                    }

                } catch (e) {
                    console.error("Error parsing item list:", e);
                    itemListElement.innerHTML = '<li><span>Error loading item details.</span><span></span></li>';
                }
                
            } else {
                document.querySelector('.container').innerHTML = 
                    '<div class="status-header"><h1>Receipt Not Found</h1><p style="color:red;">No recent transaction data available. Please complete a payment first.</p><a href="index.html" class="shop-btn" style="display:block; margin-top:20px;">Go to Home</a></div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadReceiptDetails);
    </script>
</body>
</html>